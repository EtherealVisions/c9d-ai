#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit quality checks..."

# Quality validation pipeline - all must pass
echo "ğŸ“ TypeScript compilation check..."
pnpm typecheck || {
  echo "âŒ TypeScript compilation failed. Fix type errors before committing."
  exit 1
}

echo "ğŸ§¹ Code linting check..."
pnpm lint || {
  echo "âŒ Linting failed. Fix linting errors before committing."
  exit 1
}

echo "ğŸ§ª Running tests with coverage..."
pnpm test:coverage || {
  echo "âŒ Tests failed or coverage thresholds not met. Fix tests before committing."
  exit 1
}

echo "ğŸ’… Code formatting check..."
pnpm format:check || {
  echo "âŒ Code formatting issues detected. Run 'pnpm format' to fix."
  exit 1
}

echo "ğŸ”’ Security scan..."
pnpm audit --audit-level moderate || {
  echo "âš ï¸  Security vulnerabilities detected. Review and fix before committing."
  exit 1
}

echo "âœ… All pre-commit checks passed! Proceeding with commit..."