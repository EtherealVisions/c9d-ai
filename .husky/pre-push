#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push quality validation..."

# Comprehensive validation pipeline for merge/push
echo "ğŸ“¦ Clean dependency installation..."
pnpm install --frozen-lockfile || {
  echo "âŒ Dependency installation failed."
  exit 1
}

echo "ğŸ“ TypeScript compilation..."
pnpm typecheck || {
  echo "âŒ TypeScript compilation failed."
  exit 1
}

echo "ğŸ§¹ Code linting and security..."
pnpm lint || {
  echo "âŒ Linting failed."
  exit 1
}

echo "ğŸ§ª Full test suite with coverage..."
pnpm test:coverage || {
  echo "âŒ Test suite failed or coverage thresholds not met."
  exit 1
}

echo "ğŸ”— Integration tests..."
pnpm test:integration || {
  echo "âŒ Integration tests failed."
  exit 1
}

echo "ğŸŒ End-to-end tests..."
pnpm test:e2e || {
  echo "âŒ E2E tests failed."
  exit 1
}

echo "ğŸ—ï¸  Production build..."
pnpm build || {
  echo "âŒ Production build failed."
  exit 1
}

echo "âœ… All pre-push checks passed! Ready for merge..."